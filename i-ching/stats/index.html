<!DOCTYPE html>
<html lang="it">
    <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tendenze ¬∑ Jacopo Donati</title>
    <meta name="title" content="Tendenze ¬∑ Jacopo Donati">
    <meta name="description" content="üçïüçï">
    <meta name="author" content="Jacopo Donati">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.jacopodonati.it/i-ching/stats/">
    <meta property="og:title" content="Tendenze">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.jacopodonati.it/i-ching/stats/">
    <meta property="og:description" content="Un piccolo esperimento statistico.">
    <meta name="twitter:description" content="Un piccolo esperimento statistico.">
    <meta property="article:author" content="Jacopo Donati">
    <meta property="article:section" content="Blog">
    <meta property="article:published_time" content="2022-08-04T04:42+0000">
    <meta name="twitter:site" content="@_jacopodonati">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@_jacopodonati">
    <meta name="twitter:title" content="Tendenze">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#f9f7f6">
    <meta name="apple-mobile-web-app-title" content="Jacopo Donati">
    <meta name="application-name" content="Jacopo Donati">
    <meta name="msapplication-TileColor" content="#f9f7f6">
    <meta name="theme-color" content="#f9f7f6" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#23201f" media="(prefers-color-scheme: dark)">

    <link rel="stylesheet" href="/scss/main.min.4c1d64e53629a07417fcaa5f0b7eef7f44228a5052e49674a4e765799ab7b4c1.css" integrity="sha256-TB1k5TYpoHQX/KpfC37vf0QiilBS5JZ0pOdleZq3tME=">
    <link rel="stylesheet" href="/scss/print.min.c12cd6c3738edc9bc35f04921032f12c71d6220f85c6f2c91b248e50c28b4cbb.css" integrity="sha256-wSzWw3OO3JvDXwSSEDLxLHHWIg&#43;FxvLJGySOUMKLTLs=" media="print">

    <script src="./daily.js" type="module"></script>
    <script src="/js/chart.min.js"></script>
    <script src="/js/luxon.min.js"></script>
    <script src="/js/chartjs-adapter-luxon.js"></script>

    </head>
    <body>    <div id="home-header">
        <div class="left">
            <div class="nome">
                <a href="/">Jacopo Donati</a>
            </div>
            <div id="location">üìç <span id="current_location"></span><span id="freccia" class="nascosto">‚Üí</span><span id="next_location"></span></div>
        </div>
        <div id="photo">
            <img src="img/crapa.jpg" srcset="/img/crapa_hua361419d8f6a05dd4397cd9afaae28ad_342200_0x144_resize_q80_h2_box.webp 1x, /img/crapa_hua361419d8f6a05dd4397cd9afaae28ad_342200_0x216_resize_q80_h2_box.webp 2x, /img/crapa_hua361419d8f6a05dd4397cd9afaae28ad_342200_0x288_resize_q80_h2_box.webp 3x, /img/crapa_hua361419d8f6a05dd4397cd9afaae28ad_342200_0x360_resize_q80_h2_box.webp 4x" alt="Jacopo Donati" width="72" height="72">
        </div>
    </div>
        <main id="content" class="i-ching page">
<article>
    <h1>Tendenze</h1>
    <p>Un piccolo esperimento statistico.</p>

    <section class="chart">
        <canvas id="daily-throws" width="400" height="400"></canvas>
    </section>
</article>

        </main>
        <footer id="home-footer">
            <p>¬© 2020-2022 Jacopo Donati</p>
        </footer>
<script type="module">
    import { daily_throws } from './daily.js';

    function compileThrows(throws) {
        let data = {
            'primaries': [],
            'relatives' : []
        }

        throws.forEach(day => {
            const timestamp = day.date;
            day.throws.forEach(single_throw => {
                if (data.primaries.some(e => e.y === single_throw[0])) {
                    let old = data.primaries.find(th => th.y === single_throw[0]);
                    old.r += 1;
                } else {
                    data.primaries.push({
                        x: timestamp,
                        y: single_throw[0],
                        r: 1
                    });
                }
                if (single_throw.length > 1) {
                    if (data.relatives.some(e => e.y === single_throw[1])) {
                        let old = data.relatives.find(th => th.y === single_throw[1]);
                        old.r += 1;
                    } else {
                        data.relatives.push({
                            x: timestamp,
                            y: single_throw[1],
                            r: 1
                        });
                    }
                }
            });
        });
        return data;
    }

    function getMean(throws) {
        let data = {
            labels: [],
            primaries: [],
            relatives: []
        };

        throws.forEach(th => {
            let primary = {
                count: 0,
                value: 0
            };
            let relative = {
                count: 0,
                value: 0
            };

            th.throws.forEach(t => {
                primary.value += t[0];
                primary.count += 1;

                if (t.length > 1) {
                    relative.value += t[0];
                    relative.count += 1;
                }
            });
            data.labels.push(th.date);
            data.primaries.push(primary.value / primary.count);
            data.relatives.push(relative.value / relative.count);
        });
        return data;
    }

    let daily_data = compileThrows(daily_throws);
    let daily_mean = getMean(daily_throws);
    console.log(daily_mean)

    const dtc = document.getElementById('daily-throws').getContext('2d');
    const dailyThrows = new Chart(dtc, {
        type: 'bubble',
        data: {
            datasets: [
                {
                    label: 'Primari',
                    data: daily_data.primaries,
                    backgroundColor: 'rgb(101, 156, 219)'
                },
                {
                    label: 'Relativi',
                    data: daily_data.relatives,
                    backgroundColor: 'rgb(227, 185, 86)'
                },
                {
                    type: 'line',
                    label: 'Media primari',
                    data: daily_mean.primaries,
                },
                {
                    type: 'line',
                    label: 'Media relativi',
                    data: daily_mean.relatives,
                }
            ],
            labels: daily_mean.labels
        },
        options: {
            locale: 'it',
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'day',
                        displayFormats: {
                            day: 'd MMMM'
                        }
                    }
                },
                y: {
                    min: 1,
                    max: 64,
                    ticks: {
                        stepSize: 8
                    }
                }
            }
        }
    });
</script>

        <script>
            var locations_list = JSON.parse('[{\u0022coordinates\u0022:\u002244.4991182,11.3316855\u0022,\u0022date\u0022:\u00222022-01-01\u0022,\u0022label\u0022:\u0022Bologna\u0022},{\u0022coordinates\u0022:\u002238.1405227,13.2870768\u0022,\u0022date\u0022:\u00222022-04-07\u0022,\u0022label\u0022:\u0022Palermo\u0022},{\u0022coordinates\u0022:\u002244.4991182,11.3316855\u0022,\u0022date\u0022:\u00222022-04-11\u0022,\u0022label\u0022:\u0022Bologna\u0022}]');
            var current_date = new Date();
            var current_location;
            var next_location;
            
            var i = 0;
            do {
                let location = locations_list[i];
                let location_date = new Date(location.date);
                if (current_date < location_date) {
                    next_location = location;
                    break;
                } else {
                    current_location = location;
                    i++;
                }
                if (i == locations_list.length) { break; }
            } while (next_location == null);

            document.querySelector('#current_location').textContent = current_location.label;

            if (next_location != null) {
                document.querySelector('#freccia').classList.remove('nascosto');
                document.querySelector('#next_location').textContent = next_location.label;
            }
        </script>
    </body>
</html>
